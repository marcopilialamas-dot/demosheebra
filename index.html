<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Demo Sheebra ðŸ¦“</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.2.47/vue.global.prod.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root { --p: #4f46e5; --bg: #f3f4f6; --c: #111827; --w: #ffffff; --safe-b: 80px; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--c); margin: 0; display: flex; flex-direction: column; height: 100vh; }
        .content { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: calc(var(--safe-b) + 80px); -webkit-overflow-scrolling: touch; }
        .card { background: var(--w); border-radius: 12px; padding: 15px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); margin-bottom: 15px; animation: fadeIn 0.3s ease-in-out; }
        input, select { padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; width: 100%; box-sizing: border-box; font-size: 14px; margin-bottom: 8px; background: white; }
        .btn { padding: 12px; border-radius: 8px; border: none; font-weight: 700; cursor: pointer; width: 100%; font-size: 14px; text-transform: uppercase; margin-top: 5px; }
        .btn-p { background: var(--p); color: white; }
        .btn-d { background: #fee2e2; color: #b91c1c; }
        .btn-s { background: white; border: 1px solid #d1d5db; color: #374151; }
        .btn-w { background: #fef3c7; color: #b45309; border: 1px solid #fcd34d; }
        .badge { padding: 4px 8px; border-radius: 6px; font-size: 11px; font-weight: bold; display: inline-block; }
        .bg-green { background: #dcfce7; color: #166534; }
        .bg-red { background: #fee2e2; color: #991b1b; }
        .bg-blue { background: #dbeafe; color: #1e40af; }
        .dash-grid { display: grid; grid-template-columns: 1fr; gap: 10px; }
        .kpi-card { background: white; padding: 15px; border-radius: 12px; border: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center; }
        .kpi-val { font-size: 20px; font-weight: 800; }
        .kpi-sub { font-size: 10px; color: #6b7280; text-transform: uppercase; font-weight: 700; }
        table { width: 100%; border-collapse: collapse; font-size: 12px; }
        th { text-align: left; padding: 8px; color: #6b7280; border-bottom: 2px solid #e5e7eb; }
        td { padding: 10px 8px; border-bottom: 1px solid #f3f4f6; }
        .scroll-x { overflow-x: auto; -webkit-overflow-scrolling: touch; }
        .btm-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: white; border-top: 1px solid #e5e7eb; display: flex; justify-content: space-around; padding: 10px 0; padding-bottom: max(10px, env(safe-area-inset-bottom)); z-index: 1000; }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; font-size: 10px; color: #9ca3af; font-weight: 600; width: 20%; }
        .nav-item.active { color: var(--p); }
        .nav-icon { font-size: 20px; }
        .loading { position: fixed; inset: 0; background: rgba(255, 255, 255, 0.8); display: flex; align-items: center; justify-content: center; z-index: 9999; }
        @keyframes fadeIn { from { opacity: 0.7; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        .cta-float {
            position: fixed; bottom: 90px; right: 20px; 
            background: #16a34a; color: white; 
            padding: 10px 20px; border-radius: 50px; 
            font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            z-index: 2000; display: flex; align-items: center; gap: 8px;
            animation: bounce 2s infinite; cursor: pointer;
            text-decoration: none; font-size: 13px;
        }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
    </style>
</head>
<body>
    <div id="app">
        
        <a href="https://wa.me/549XXXXXXXXXX?text=Hola!%20ProbÃ©%20la%20demo%20de%20Sheebra%20y%20me%20interesa" target="_blank" class="cta-float">
            <span>ðŸš€ Â¿LO QUIERES?</span>
        </a>

        <div style="background:white; padding:15px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center">
            <div style="font-weight:800; color:var(--p)">Sheebra V3 ðŸ¦“</div>
            <div class="badge bg-blue">DEMO PREMIUM</div>
        </div>

        <div class="content">
            <div v-show="tab === 'dash'">
                <div style="padding:15px; background:white; margin-bottom:15px; border-radius:8px">
                     <div style="display:flex; gap:20px; align-items:end; flex-wrap:wrap">
                        <div style="flex:1;">
                            <label style="display:block; font-size:11px; color:#6b7280; margin-bottom:5px; font-weight:700">DESDE</label>
                            <input type="date" v-model="startDate">
                        </div>
                        <div style="flex:1;">
                            <label style="display:block; font-size:11px; color:#6b7280; margin-bottom:5px; font-weight:700">HASTA</label>
                            <input type="date" v-model="endDate">
                        </div>
                    </div>
                </div>

                <div class="dash-grid">
                    <div class="kpi-card">
                        <div><div class="kpi-sub">VENTAS BRUTAS</div><div class="kpi-val">${{ rangeTotal.toLocaleString() }}</div></div>
                        <div class="badge bg-green">{{ rangeCount }} Tx</div>
                    </div>
                    <div class="kpi-card">
                        <div><div class="kpi-sub">UTILIDAD (30%)</div><div class="kpi-val text-green">${{ rangeNet.toLocaleString() }}</div></div>
                    </div>
                </div>
                
                <div class="card" style="margin-top:15px; height:200px">
                    <canvas id="salesChart"></canvas>
                </div>
                
                <div class="dash-grid" style="grid-template-columns: 1fr; margin-top:15px">
                    <div class="card" style="height:220px; text-align:center">
                        <h4 style="margin:0 0 10px 0; font-size:11px; color:#6b7280">INGRESOS</h4>
                        <div style="width:100%; height:160px"><canvas id="incomeDonut"></canvas></div>
                    </div>
                </div>
                
                <div style="margin-top:20px; text-transform:uppercase; font-size:11px; font-weight:bold; color:#6b7280; margin-bottom:5px">ÃšLTIMAS VENTAS</div>
                <div class="card scroll-x">
                    <table>
                        <thead><tr><th>Hora</th><th>Total</th><th>Pago</th></tr></thead>
                        <tbody>
                            <tr v-for="s in filteredSales.slice(0,10)" :key="s.txnId">
                                <td>{{ formatTime(s.time) }}</td>
                                <td style="font-weight:bold">${{ s.total.toLocaleString() }}</td>
                                <td>{{ s.method }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div v-if="tab === 'stock'">
                <h3>ðŸ“¦ Ingreso & PPP</h3>
                <div class="card">
                    <input v-model="stockSearch" placeholder="Buscar producto (ej: Coca)..." @input="filterStockProds">
                    
                    <div v-if="stockQueryResults.length" style="background:#f9fafb; border:1px solid #ddd; max-height:150px; overflow-y:auto; margin-bottom:10px; border-radius:8px">
                        <div v-for="p in stockQueryResults" @click="addToRestock(p)" style="padding:10px; border-bottom:1px solid #eee; font-size:12px; cursor:pointer">
                            <b>{{ p[1] }}</b> <span style="color:#666">Cost.Act: ${{p[4]}}</span>
                        </div>
                    </div>

                    <div v-if="restockQueue.length">
                        <div v-for="(item, idx) in restockQueue" :key="idx" style="padding:10px; background:#f0f9ff; margin-bottom:10px; border-radius:8px; border:1px solid #bae6fd">
                            <div style="display:flex; justify-content:space-between; margin-bottom:5px">
                                <b style="font-size:12px">{{ item.name }}</b>
                                <button class="btn-d" style="width:24px; height:24px; padding:0; border-radius:50%" @click="restockQueue.splice(idx,1)">Ã—</button>
                            </div>
                            <div style="display:flex; gap:5px">
                                <div><label style="font-size:10px">Cant.</label><input type="number" v-model.number="item.qty" style="padding:5px"></div>
                                <div><label style="font-size:10px">Costo Nuevo</label><input type="number" v-model.number="item.cost" style="padding:5px"></div>
                            </div>
                        </div>

                        <hr style="border:0; border-top:1px solid #eee; margin:15px 0">
                        
                        <label style="font-size:12px; font-weight:bold">MÃ©todo de Egreso (Pago al Prov.)</label>
                        <select v-model="restockPayMethod">
                            <option>Efectivo Caja</option>
                            <option>Transferencia</option>
                            <option>Cuenta Corriente</option>
                        </select>

                        <button class="btn btn-p" @click="fakeProcess">CONFIRMAR INGRESO (Calc. PPP)</button>
                    </div>
                </div>
            </div>

            <div v-if="tab === 'inv'">
                <div style="display:flex; gap:10px; margin-bottom:10px; align-items:center">
                    <input v-model="invSearch" placeholder="SKU o Nombre" style="margin:0">
                    <button class="btn btn-p" style="width:50px; margin:0" @click="showEdit({})">+</button>
                </div>
                
                <button class="btn btn-w" @click="fakeBulkImport" style="margin-bottom:15px; font-size:12px">
                    âš¡ SIMULAR CARGA MASIVA (Excel)
                </button>

                <div style="height:400px; overflow-y:auto">
                    <div v-for="p in filteredProducts" :key="p[0]" @click="showEdit(p)" class="card" style="padding:10px; display:flex; justify-content:space-between; align-items:center">
                        <div>
                            <div style="font-weight:bold">{{ p[1] }}</div>
                            <div style="font-size:11px; color:#666">{{ p[0] }}</div>
                        </div>
                        <div style="text-align:right">
                            <div style="font-weight:bold; color:var(--p)">${{ p[2] }}</div>
                            <div style="font-size:11px; color:#666">Costo: ${{ p[4].toFixed(0) }}</div>
                            <div class="badge bg-green">{{ p[3] }} u.</div>
                        </div>
                    </div>
                </div>
            </div>

             <div v-if="tab === 'users'">
                <div class="card" style="text-align:center; padding:40px 20px;">
                    <div style="font-size:40px; margin-bottom:10px">ðŸ”’</div>
                    <h3>GestiÃ³n de Usuarios</h3>
                    <p style="color:#666; font-size:13px">Esta funciÃ³n estÃ¡ bloqueada en la DEMO pÃºblica por seguridad.</p>
                    <a href="#" class="btn btn-p" style="display:block; text-decoration:none; margin-top:20px">Contactar para versiÃ³n completa</a>
                </div>
            </div>
        </div>

        <div class="btm-nav">
            <div class="nav-item" :class="{active: tab==='dash'}" @click="tab='dash'"><span class="nav-icon">ðŸ“Š</span><span>Dash</span></div>
            <div class="nav-item" :class="{active: tab==='stock'}" @click="tab='stock'"><span class="nav-icon">ðŸ“¦</span><span>Stock</span></div>
            <div class="nav-item" :class="{active: tab==='inv'}" @click="tab='inv'"><span class="nav-icon">ðŸ“‹</span><span>Inv</span></div>
            <div class="nav-item" :class="{active: tab==='users'}" @click="tab='users'"><span class="nav-icon">ðŸ‘¥</span><span>Team</span></div>
        </div>

        <div v-if="editor.show" class="loading" style="background:rgba(0,0,0,0.8)">
            <div class="card" style="width:85%; max-width:400px;">
                <h3>{{ editor.isNew ? 'Nuevo Producto' : 'Editar Producto' }}</h3>
                <label>Nombre</label><input v-model="editor.name">
                <div style="display:flex; gap:10px">
                    <div><label>Precio</label><input type="number" v-model.number="editor.price"></div>
                    <div><label>Costo</label><input type="number" v-model.number="editor.cost"></div>
                </div>
                <label>Stock Inicial</label><input type="number" v-model.number="editor.stock">
                
                <div style="margin-top:15px; gap:10px; display:flex; flex-direction:column">
                    <button class="btn btn-p" @click="fakeSave">Guardar</button>
                    <button class="btn btn-s" @click="editor.show=false">Cancelar</button>
                </div>
            </div>
        </div>

        <div v-if="loading" class="loading"><div style="background:white; padding:20px; border-radius:10px">âœ¨ Procesando...</div></div>
    </div>

    <script>
        const { createApp } = Vue;
        
        try {
            createApp({
                data() {
                    // Inicializar fechas: Desde hace 15 dÃ­as hasta hoy
                    const end = new Date();
                    const start = new Date();
                    start.setDate(end.getDate() - 15);
                    
                    return {
                        version: 'V3.0',
                        tab: 'dash', loading: false, isUpdating: false,
                        startDate: start.toISOString().split('T')[0], 
                        endDate: end.toISOString().split('T')[0],
                        chartRenderTimeout: null,
                        
                        stockSearch: '', invSearch: '', 
                        
                        // BASE DE DATOS INICIAL
                        products: [
                            ['SKU101', 'Coca Cola 2.25L', 3200, 45, 2100, 10],
                            ['SKU102', 'Fernet Branca 750ml', 8500, 12, 6000, 5],
                            ['SKU103', 'Alfajor Jorgito', 800, 100, 450, 20],
                            ['SKU104', 'Cerveza Quilmes 1L', 2500, 24, 1500, 10],
                            ['SKU105', 'Gomitas Mogul', 1200, 30, 600, 5],
                        ],
                        
                        allSales: [], 
                        stockQueryResults: [], 
                        restockQueue: [], 
                        restockPayMethod: 'Efectivo Caja', // NUEVO CAMPO
                        editor: { show: false, sku: '', name: '', price: 0, stock: 0, cost:0, isNew: false },
                        
                        rangeTotal: 0, rangeCount: 0, rangeNet: 0, filteredSales: []
                    }
                },
                computed: {
                    filteredProducts() {
                        const termino = String(this.invSearch || ""); 
                        const q = termino.toUpperCase();
                        if (!this.products) return [];
                        return this.products.filter(p => {
                            if (!p) return false;
                            const sku = String(p[0] || "").toUpperCase();
                            const name = String(p[1] || "").toUpperCase();
                            return name.includes(q) || sku.includes(q);
                        }).slice(0, 50); // Muestro mÃ¡s productos
                    }
                },
                watch: {
                    tab(v) { 
                        if (v === 'dash') this.triggerChartUpdate();
                    },
                    // AL CAMBIAR FECHAS, ACTUALIZAR GRAFICOS
                    startDate() { this.triggerChartUpdate(); },
                    endDate() { this.triggerChartUpdate(); }
                },
                methods: {
                    triggerChartUpdate(){
                        if(this.chartRenderTimeout) clearTimeout(this.chartRenderTimeout);
                        this.chartRenderTimeout = setTimeout(() => this.refreshData(), 300);
                    },
                    generateFakeSales() {
                        const methods = ['Efectivo', 'Efectivo', 'Mercadopago', 'Debito'];
                        const now = new Date();
                        // Generar ventas en los ultimos 20 dias
                        for(let i=0; i<30; i++) {
                            const randomProd = this.products[Math.floor(Math.random() * this.products.length)];
                            const qty = Math.floor(Math.random() * 3) + 1;
                            // Fecha aleatoria entre hace 20 dias y hoy
                            const daysAgo = Math.floor(Math.random() * 20);
                            const time = new Date();
                            time.setDate(now.getDate() - daysAgo);
                            time.setHours(Math.floor(Math.random() * 12) + 9); // 9am a 9pm
                            
                            this.allSales.push({
                                txnId: i,
                                date: time.toISOString().split('T')[0], // YYYY-MM-DD
                                time: time.toISOString(),
                                total: randomProd[2] * qty,
                                method: methods[Math.floor(Math.random() * methods.length)],
                                items: `${randomProd[1]} x${qty}`
                            });
                        }
                        this.refreshData();
                    },
                    refreshData() {
                        // FILTRAR POR FECHAS REALES
                        const start = new Date(this.startDate);
                        const end = new Date(this.endDate);
                        end.setHours(23, 59, 59); // Final del dÃ­a

                        this.filteredSales = this.allSales.filter(s => {
                            const d = new Date(s.date);
                            // Ajuste de zona horaria simple
                            return d >= start && d <= new Date(this.endDate + 'T23:59:59');
                        }).sort((a,b) => new Date(b.time) - new Date(a.time));

                        this.rangeTotal = this.filteredSales.reduce((a, b) => a + b.total, 0);
                        this.rangeCount = this.filteredSales.length;
                        this.rangeNet = Math.round(this.rangeTotal * 0.3);
                        
                        this.renderChart(this.filteredSales);
                    },
                    renderChart(sales) {
                        if (this.tab !== 'dash') return;
                        if (typeof Chart === 'undefined') return;

                        requestAnimationFrame(() => {
                            const ctx1 = document.getElementById('salesChart');
                            const ctx2 = document.getElementById('incomeDonut');
                            if(!ctx1 || ctx1.offsetParent === null) return;

                            try {
                                const existing1 = Chart.getChart(ctx1);
                                if(existing1) existing1.destroy();
                                const existing2 = Chart.getChart(ctx2);
                                if(existing2) existing2.destroy();

                                const hours = {};
                                sales.forEach(s => {
                                    const h = new Date(s.time).getHours();
                                    hours[h] = (hours[h] || 0) + s.total;
                                });
                                
                                new Chart(ctx1, {
                                    type: 'bar',
                                    data: {
                                        labels: Object.keys(hours).map(h => h+'h'),
                                        datasets: [{ label: 'Ventas', data: Object.values(hours), backgroundColor: '#4f46e5', borderRadius: 4 }]
                                    },
                                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
                                });

                                const methods = {};
                                sales.forEach(s => methods[s.method] = (methods[s.method] || 0) + s.total);
                                new Chart(ctx2, {
                                    type: 'doughnut',
                                    data: {
                                        labels: Object.keys(methods),
                                        datasets: [{ data: Object.values(methods), backgroundColor: ['#16a34a', '#06b6d4', '#2563eb', '#eab308'] }]
                                    },
                                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
                                });
                            } catch(e) { console.error(e); }
                        });
                    },
                    fakeProcess() {
                        this.loading = true;
                        setTimeout(() => {
                            this.loading = false;
                            
                            // LOGICA PPP (PRECIO PROMEDIO PONDERADO)
                            let mensaje = "âœ… STOCK ACTUALIZADO:\n";
                            
                            this.restockQueue.forEach(item => {
                                // Buscar producto original
                                const prodIndex = this.products.findIndex(p => p[1] === item.name);
                                if(prodIndex > -1) {
                                    const p = this.products[prodIndex];
                                    const stockActual = p[3];
                                    const costoActual = p[4];
                                    const cantidadNueva = item.qty;
                                    const costoNuevo = item.cost;
                                    
                                    // FORMULA PPP
                                    const valorTotal = (stockActual * costoActual) + (cantidadNueva * costoNuevo);
                                    const stockTotal = stockActual + cantidadNueva;
                                    const ppp = valorTotal / stockTotal;
                                    
                                    // Actualizar producto en memoria
                                    p[3] = stockTotal;
                                    p[4] = Math.round(ppp);
                                    
                                    mensaje += `- ${item.name}: Nuevo Costo Promedio $${p[4]}\n`;
                                }
                            });
                            
                            mensaje += `\nðŸ’° Pago registrado con: ${this.restockPayMethod}`;

                            this.restockQueue = [];
                            alert(mensaje);
                        }, 800);
                    },
                    fakeBulkImport() {
                        this.loading = true;
                        setTimeout(() => {
                            // GENERAR 20 PRODUCTOS RANDOM
                            const brands = ['Arcor', 'Bagley', 'Terrabusi', 'La Campagnola'];
                            const types = ['Mermelada', 'Galletas', 'Fideos', 'Arroz'];
                            
                            for(let i=0; i<20; i++) {
                                const brand = brands[Math.floor(Math.random()*brands.length)];
                                const type = types[Math.floor(Math.random()*types.length)];
                                const price = (Math.floor(Math.random() * 50) + 10) * 100;
                                
                                this.products.push([
                                    'IMP-' + Math.floor(Math.random()*9000+1000), // SKU
                                    `${type} ${brand} Importado`, // Name
                                    price, // Price
                                    Math.floor(Math.random()*100), // Stock
                                    price * 0.6, // Cost
                                    10 // Reorder
                                ]);
                            }
                            this.loading = false;
                            alert(`âœ¨ Â¡ImportaciÃ³n Exitosa! \nSe agregaron 20 productos desde "Excel"`);
                        }, 1000);
                    },
                    fakeSave() {
                        this.loading = true;
                        setTimeout(() => {
                            this.loading = false;
                            if(this.editor.isNew) {
                                this.products.push(['NEW-'+Math.random().toString().substr(2,4), this.editor.name, this.editor.price, this.editor.stock, this.editor.cost, 5]);
                            } else {
                                // Encontrar y editar (simulado)
                                const idx = this.products.findIndex(p => p[0] === this.editor.sku);
                                if(idx > -1) {
                                    this.products[idx][1] = this.editor.name;
                                    this.products[idx][2] = this.editor.price;
                                    this.products[idx][3] = this.editor.stock;
                                    this.products[idx][4] = this.editor.cost;
                                }
                            }
                            this.editor.show = false;
                            alert("âœ¨ Â¡Producto guardado!");
                        }, 800);
                    },
                    formatTime(iso) { return new Date(iso).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}); },
                    filterStockProds() {
                        const q = String(this.stockSearch || "").toUpperCase();
                        this.stockQueryResults = q ? this.products.filter(p => String(p[1]).toUpperCase().includes(q)).slice(0,5) : [];
                    },
                    addToRestock(p) { 
                        // Agregar con el costo actual por defecto
                        this.restockQueue.push({name:p[1], qty:1, cost:p[4]}); 
                        this.stockSearch=''; this.stockQueryResults=[]; 
                    },
                    showEdit(p) {
                        if(p[0]) this.editor = { show:true, sku:p[0], name:p[1], price:p[2], stock:p[3], cost:p[4], isNew:false };
                        else this.editor = { show:true, sku:'', name:'', price:0, stock:0, cost:0, isNew:true };
                    }
                },
                mounted() {
                    console.log("SHEEBRA V3 START");
                    this.generateFakeSales(); 
                }
            }).mount('#app');
        } catch (err) {
            alert("Error crÃ­tico al iniciar: " + err.message);
        }
    </script>
</body>
</html>




